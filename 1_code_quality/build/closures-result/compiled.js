jQuery(function(d){Handlebars.registerHelper("eq",function(a,b,c){return a===b?c.fn(this):c.inverse(this)});var e={uuid:function(){var a,b,c="";for(a=0;32>a;a++){b=16*Math.random()|0;if(8===a||12===a||16===a||20===a)c+="-";c+=(12===a?4:16===a?b&3|8:b).toString(16)}return c},pluralize:function(a,b){return 1===a?b:b+"s"},store:function(a,b){if(1<arguments.length)return localStorage.setItem(a,JSON.stringify(b));var c=localStorage.getItem(a);return c&&JSON.parse(c)||[]}};({init:function(){this.todos=
e.store("todos-jquery");this.cacheElements();this.bindEvents();(new Router({"/:filter":function(a){this.filter=a;this.render()}.bind(this)})).init("/all")},cacheElements:function(){this.todoTemplate=Handlebars.compile(d("#todo-template").html());this.footerTemplate=Handlebars.compile(d("#footer-template").html());this.$todoApp=d("#todoapp");this.$header=this.$todoApp.find("#header");this.$main=this.$todoApp.find("#main");this.$footer=this.$todoApp.find("#footer");this.$newTodo=this.$header.find("#new-todo");
this.$toggleAll=this.$main.find("#toggle-all");this.$todoList=this.$main.find("#todo-list");this.$count=this.$footer.find("#todo-count");this.$clearBtn=this.$footer.find("#clear-completed")},bindEvents:function(){var a=this.$todoList;this.$newTodo.on("keyup",this.create.bind(this));this.$toggleAll.on("change",this.toggleAll.bind(this));this.$footer.on("click","#clear-completed",this.destroyCompleted.bind(this));a.on("change",".toggle",this.toggle.bind(this));a.on("dblclick","label",this.edit.bind(this));
a.on("keyup",".edit",this.editKeyup.bind(this));a.on("focusout",".edit",this.update.bind(this));a.on("click",".destroy",this.destroy.bind(this))},render:function(){var a=this.getFilteredTodos();this.$todoList.html(this.todoTemplate(a));this.$main.toggle(0<a.length);this.$toggleAll.prop("checked",0===this.getActiveTodos().length);this.renderFooter();this.$newTodo.focus();e.store("todos-jquery",this.todos)},renderFooter:function(){var a=this.todos.length,b=this.getActiveTodos().length,b=this.footerTemplate({activeTodoCount:b,
activeTodoWord:e.pluralize(b,"item"),completedTodos:a-b,filter:this.filter});this.$footer.toggle(0<a).html(b)},toggleAll:function(a){var b=d(a.target).prop("checked");this.todos.forEach(function(a){a.completed=b});this.render()},getActiveTodos:function(){return this.todos.filter(function(a){return!a.completed})},getCompletedTodos:function(){return this.todos.filter(function(a){return a.completed})},getFilteredTodos:function(){return"active"===this.filter?this.getActiveTodos():"completed"===this.filter?
this.getCompletedTodos():this.todos},destroyCompleted:function(){this.todos=this.getActiveTodos();this.filter="all";this.render()},indexFromEl:function(a){a=d(a).closest("li").data("id");for(var b=this.todos,c=b.length;c--;)if(b[c].id===a)return c},create:function(a){var b=d(a.target),c=b.val().trim();13===a.which&&c&&(this.todos.push({id:e.uuid(),title:c,completed:!1}),b.val(""),this.render())},toggle:function(a){a=this.indexFromEl(a.target);this.todos[a].completed=!this.todos[a].completed;this.render()},
edit:function(a){a=d(a.target).closest("li").addClass("editing").find(".edit");a.val(a.val()).focus()},editKeyup:function(a){13===a.which&&a.target.blur();27===a.which&&d(a.target).data("abort",!0).blur()},update:function(a){var b=a.target,c=d(b);a=c.val().trim();c.data("abort")?c.data("abort",!1):(b=this.indexFromEl(b),a?this.todos[b].title=a:this.todos.splice(b,1));this.render()},destroy:function(a){this.todos.splice(this.indexFromEl(a.target),1);this.render()}}).init()});
